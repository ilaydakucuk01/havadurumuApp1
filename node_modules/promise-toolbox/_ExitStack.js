"use strict";

var isDisposable = require("./_isDisposable");

var resolve = require("./_resolve");

module.exports = function () {
  function ExitStack() {
    var _this = this;

    this._disposables = [];

    var dispose = function dispose() {
      var disposable = _this._disposables.pop();

      return disposable !== undefined ? resolve(disposable.dispose()).then(dispose) : Promise.resolve();
    };

    return {
      dispose,
      value: this
    };
  }

  var _proto = ExitStack.prototype;

  _proto.enter = function enter(disposable) {
    if (!isDisposable(disposable)) {
      throw new TypeError("not a disposable");
    }

    this._disposables.push(disposable);

    return disposable.value;
  };

  return ExitStack;
}();